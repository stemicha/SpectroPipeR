<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Function for normalizing and quantifying Spectronaut output reports,
serving as the second step in the pipeline and building upon the initial step of
reading Spectronaut data."><title>SpectroPipeR: normalization &amp; quantification module — norm_quant_module • SpectroPipeR</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="SpectroPipeR: normalization &amp; quantification module — norm_quant_module"><meta property="og:description" content="Function for normalizing and quantifying Spectronaut output reports,
serving as the second step in the pipeline and building upon the initial step of
reading Spectronaut data."><meta property="og:image" content="https://stemicha.github.io/SpectroPipeR/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light" data-bs-theme="light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">SpectroPipeR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/a01_SpectroPipeR_read_Spectronaut_data.html">SpectroPipeR - step 1 - read Spectronaut data</a>
    <a class="dropdown-item" href="../articles/a02_SpectroPipeR_norm_quant.html">SpectroPipeR - step 2 - normalization and quantification</a>
    <a class="dropdown-item" href="../articles/a03_SpectroPipeR_MVA_analysis.html">SpectroPipeR - step 3 -  MVA analysis</a>
    <a class="dropdown-item" href="../articles/a04_SpectroPipeR_statistics.html">SpectroPipeR - step 4 - statistics</a>
    <a class="dropdown-item" href="../articles/a05_SpectroPipeR_reporting.html">SpectroPipeR - step 5 - reporting</a>
    <a class="dropdown-item" href="../articles/a06_SpectroPipeR_XIC_plot.html">SpectroPipeR - XIC plotting</a>
    <a class="dropdown-item" href="../articles/a07_Gprofiler2_code_suggestion.html">SpectroPipeR - stat. results functional enrichment analysis</a>
  </div>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"></ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>SpectroPipeR: normalization &amp; quantification module</h1>
      
      <div class="d-none name"><code>norm_quant_module.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Function for normalizing and quantifying Spectronaut output reports,
serving as the second step in the pipeline and building upon the initial step of
reading Spectronaut data.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">norm_quant_module</span><span class="op">(</span></span>
<span>  SpectroPipeR_data <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  batch_adjusting <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  sample__batch_meta_data_file <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  batch_adjusting_column <span class="op">=</span> <span class="st">""</span>,</span>
<span>  number_of_cores_adjusting <span class="op">=</span> <span class="fu">parallel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/parallel/detectCores.html" class="external-link">detectCores</a></span><span class="op">(</span><span class="op">)</span> <span class="op">-</span> <span class="fl">2</span>,</span>
<span>  covariate_adjusting_formula <span class="op">=</span> <span class="st">""</span>,</span>
<span>  covariate_adjusting_meta_data_file <span class="op">=</span> <span class="st">""</span>,</span>
<span>  skipping_MaxLFQ_median_norm <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  costum_colors <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  print.plot <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>SpectroPipeR_data</dt>
<dd><p>it is the SpectroPipeR_data list object generated by
the read_spectronaut_module() function</p></dd>


<dt>batch_adjusting</dt>
<dd><p>logical - if batch adjusting with ComBat (sva package) should be performed;
default = FALSE</p></dd>


<dt>sample__batch_meta_data_file</dt>
<dd><p>character - sample batch file; tab-delimited txt-file,
containing "R.FileName" column e.g. sample__batch_meta_data_file = "Sample_MetaData_Batches.txt"</p>
<p><em>example table for batch meta data:</em></p><table class="table table"><tr><td><u> <strong>R.FileName</strong> </u></td><td><u> <strong>digest_batch</strong> </u></td></tr><tr><td>20230403_TIMSTOF_1_S1-B11_1_6690</td><td>1</td></tr><tr><td>20230403_TIMSTOF_2_S1-G11_1_6695</td><td>1</td></tr><tr><td>20230403_TIMSTOF_3_S1-E7_1_6661</td><td>1</td></tr><tr><td>20230403_TIMSTOF_4_S1-A9_1_6673</td><td>2</td></tr><tr><td>20230403_TIMSTOF_7_S1-D8_1_6668</td><td>2</td></tr><tr><td>20230403_TIMSTOF_9_S1-D3_1_6627</td><td>2</td></tr></table><p><strong>A good starting point for the generation of the table is the '*_ConditionSetup.tsv' in your Spectronaut Pipeline Report export folder</strong></p></dd>


<dt>batch_adjusting_column</dt>
<dd><p>character - column name in sample__batch_meta_data_file,
which should be used for assigning the samples to batches</p></dd>


<dt>number_of_cores_adjusting</dt>
<dd><p>numeric - number of processor cores used for batch or covariate
adjustment</p></dd>


<dt>covariate_adjusting_formula</dt>
<dd><p>character - provide a formula passed to lm() for covariate
adjustment e.g. "log10_peptide_intensity ~ log10(CRP)+log10(age)+as.factor(sex)"; you may also use
ns() function e.g. "log10_peptide_intensity ~ ns(age, df=3)"</p></dd>


<dt>covariate_adjusting_meta_data_file</dt>
<dd><p>covariate meta csv file, containing "R.FileName; age; sex;...";
you may find a start file in the 02_ID_rate folder &gt; file_list.csv column e.g.
covariate_adjusting_meta_data_file = "covariate_MetaData_file.csv"</p>
<p><em>example table for covariate meta data:</em></p><table class="table table"><tr><td><u> <strong>R.FileName</strong> </u></td><td><u> <strong>R.FileName_raw</strong> </u></td><td><u> <strong>R.Condition</strong> </u></td><td><u> <strong>sex</strong> </u></td><td><u> <strong>CRP</strong> </u></td></tr><tr><td>20230403_TIMS..._S1-B11_1_6690</td><td>20230403_TIMSTOF_1_S1-B11_1_6690</td><td>heathy</td><td>1</td><td>3.8</td></tr><tr><td>20230403_TIMS..._S1-G11_1_6695</td><td>20230403_TIMSTOF_2_S1-G11_1_6695</td><td>heathy</td><td>2</td><td>5.1</td></tr><tr><td>20230403_TIMS...3_S1-E7_1_6661</td><td>20230403_TIMSTOF_3_S1-E7_1_6661</td><td>heathy</td><td>1</td><td>1.2</td></tr><tr><td>20230403_TIMS...4_S1-A9_1_6673</td><td>20230403_TIMSTOF_4_S1-A9_1_6673</td><td>cancer</td><td>1</td><td>50.2</td></tr><tr><td>20230403_TIMS...7_S1-D8_1_6668</td><td>20230403_TIMSTOF_7_S1-D8_1_6668</td><td>cancer</td><td>2</td><td>30.8</td></tr><tr><td>20230403_TIMS...9_S1-D3_1_6627</td><td>20230403_TIMSTOF_9_S1-D3_1_6627</td><td>cancer</td><td>2</td><td>64.1</td></tr></table></dd>


<dt>skipping_MaxLFQ_median_norm</dt>
<dd><p>logical - if median normalization after MaxLFQ calculation
should be skipped; default = FALSE; applied only if MaxLFQ protein estimation is selected</p></dd>


<dt>costum_colors</dt>
<dd><p>if you would like to use your own colors please provide a named color vector (e.g. c(condition1 = "black", condition2 = "grey")); names should have the same naming and length like the conditions set in Spectronaut</p></dd>


<dt>print.plot</dt>
<dd><p>logical - should a plot of normalization factors be printed</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>SpectroPipeR_norm_quant list object with the loaded raw data and processed data tables, in addition to the automatically saved tables and plots
For the description of the generated figures and tables please read the manual &amp; vignettes</p><table class="table table"><tr><td><u> <strong>list element</strong> </u></td><td><u> <strong>description</strong> </u></td></tr><tr><td>data_input_normalized</td><td><em>tibble:</em> Spectronaut report tibble provided for the analysis</td></tr><tr><td>MedianNormalizationFactor</td><td><em>tibble:</em> ion normalization factor table</td></tr><tr><td>MedianNormalizationFactor_outlier</td><td><em>tibble:</em> table containing detected norm. outliers on ion level</td></tr><tr><td>NormFactor_plot</td><td><em>ggplot2 plot:</em> norm. factor plots</td></tr><tr><td>iBAQ_intensities</td><td><em>tibble:</em> table containing the iBAQ int.</td></tr><tr><td>iBAQ_intensities_summary</td><td><em>tibble:</em> table containing the per condition summarized iBAQ int.</td></tr><tr><td>protein_data</td><td><em>tibble:</em> protein intensity table (e.g. Hi3 or MaxLFQ int.)</td></tr><tr><td>PG_2_peptides_ID_raw</td><td><em>tibble:</em> with protein groups with at least 2 peptides with peptide</td></tr><tr><td></td><td>and replicate count</td></tr><tr><td>protein_data_normalization_factor</td><td><em>tibble:</em> normalization factor table for protein int. data</td></tr><tr><td>peptide_intensity_filtered_2pep_hi3</td><td><em>tibble:</em> if Hi3 protein int. was selected a table containing</td></tr><tr><td></td><td>the peptides and intensities used for Hi3 protein intensity calculation</td></tr><tr><td>peptide_intensity</td><td><em>tibble:</em> peptides intensity table based on norm. ion intensity</td></tr><tr><td>parameter</td><td><em>list:</em> parameters provided by the user updated with the</td></tr><tr><td></td><td>norm_quant_module() parameters</td></tr><tr><td>CV_cumulative_frequency</td><td><em>tibble:</em> cumulative frequency table on peptide</td></tr><tr><td></td><td>and protein intensity level</td></tr><tr><td>sample_length</td><td><em>numberical value:</em> number of samples in the provided Spectronaut report</td></tr></table></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p><strong>batch adjustment</strong></p>
<p>Batch effects refer to systematic differences between batches (groups) of samples in high-throughput experiments.
These differences can arise due to various factors, such as batch variations in sample preparation, handling, processing
procedures and measurement orders. Batch effects can obscure the true biological signal and lead to incorrect conclusions
if not properly accounted for.
In the SpectroPipeR pipeline, the ComBat tool was employed to adjust for batch effects in the datasets where the batch
covariate was known. ComBat utilizes the methodology described in <a href="https://pubmed.ncbi.nlm.nih.gov/16632515/" class="external-link">Johnson et al. 2007</a>.
It uses an empirical Bayes (EB) framework for adjusting data for batch effects that is robust to outliers in small sample sizes
and performs comparable to existing methods for large samples. <a href="https://pubmed.ncbi.nlm.nih.gov/16632515/" class="external-link">Johnson et al. 2007:</a>
This method incorporates systematic batch biases common across genes in making adjustments, assuming that phenomena resulting in
batch effects often affect many genes in similar ways (i.e. increased expression, higher variability, etc). Specifically, the
the L/S model parameters are estimated that represent the batch effects by pooling information across peptides in each
batch to shrink the batch effect parameter estimates toward the overall mean of the batch effect estimates (across genes).
These EB estimates are then used to adjust the data for batch effects, providing more robust adjustments for the batch effect on each peptide.
In SpectroPipeR a parametric ComBAT emperical Bayes adjustment is implemented by utilizing the sva-package.</p>
<p><strong>covariate adjustment</strong></p>
<p>If a covariate adjustment of peptide intensity data was performed using the users input formula,
a linear mixed model (LMM) was calculated based on that formula per peptide and the outcoming
residuals were added to the mean peptide intensity over the samples. This means that the adjusted
peptide intensities retain their intensity level (low intense peptides keep their low intensity and
high intense ions keep their higher intensity).</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="co">#load library</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">SpectroPipeR</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># parameter list</span></span>
<span><span class="va">params</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>output_folder <span class="op">=</span> <span class="st">"../SpectroPipeR_test_folder"</span>,</span>
<span>              ion_q_value_cutoff <span class="op">=</span> <span class="fl">0.01</span>,</span>
<span>              id_drop_cutoff <span class="op">=</span> <span class="fl">0.3</span>,</span>
<span>              normalization_method <span class="op">=</span> <span class="st">"median"</span>,</span>
<span>              normalization_factor_cutoff_outlier <span class="op">=</span> <span class="fl">4</span>,</span>
<span>              filter_oxidized_peptides <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>              protein_intensity_estimation <span class="op">=</span> <span class="st">"MaxLFQ"</span>,</span>
<span>              stat_test <span class="op">=</span> <span class="st">"modt"</span>,</span>
<span>              type_slr <span class="op">=</span> <span class="st">"median"</span>,</span>
<span>              fold_change <span class="op">=</span> <span class="fl">1.5</span>,</span>
<span>              p_value_cutoff <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>              paired <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># example input file</span></span>
<span><span class="va">example_file_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>,</span>
<span>                                <span class="st">"SN_test_HYE_mix_file.tsv"</span>,</span>
<span>                                package<span class="op">=</span><span class="st">"SpectroPipeR"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># step 1: load Spectronaut data module</span></span>
<span><span class="va">SpectroPipeR_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="read_spectronaut_module.html">read_spectronaut_module</a></span><span class="op">(</span>file <span class="op">=</span> <span class="va">example_file_path</span>,</span>
<span>                                      parameter <span class="op">=</span> <span class="va">params</span>,</span>
<span>                                      print.plot <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># step 2: normalize &amp; quantification module</span></span>
<span><span class="va">SpectroPipeR_data_quant</span> <span class="op">&lt;-</span> <span class="fu">norm_quant_module</span><span class="op">(</span>SpectroPipeR_data <span class="op">=</span> <span class="va">SpectroPipeR_data</span><span class="op">)</span></span></code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Stephan Michalik.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer></div>

  

  

  </body></html>

